# Order service
version: v0.0.4
name: order
ingressAdapters:
- stateless:
    variant: rest
    action: write
    route: checkout
  steps:
  - egressAdapter:
      stateless:
        variant: rest
        service: auth
        action: read
        route: authenticate
  - egressAdapter:
      stateless:
        variant: rest
        service: cart
        action: read
        route: get
  - egressAdapter:
      stateless:
        variant: rest
        service: cost-calculation
        action: write
        route: calculate
  - egressAdapter:
      stateless:
        variant: rest
        service: payment
        action: write
        route: pay
  - egressAdapter:
      stateless:
        variant: rest
        service: user-preference
        action: write
        route: update
  - egressAdapter:
      stateful:
        name: order-db
        variant: mongo
        action: write
        size: small
  - egressAdapter:
      stateless:
        variant: rest
        service: notification
        action: write
        route: ordercreate

# Browse order
- stateless:
    variant: rest
    action: read
    route: get
  steps:
  - egressAdapter:
      stateless:
        variant: rest
        service: auth
        action: read
        route: authenticate
  - egressAdapter:
      stateful:
        name: order-db
        variant: mongo
        action: read
        size: medium
  - egressAdapter:
      stateless:
        variant: rest
        service: tracking
        action: read
        route: get
  - egressAdapter:
      stateless:
        variant: rest
        service: scheduling
        action: read
        route: get

# Cancel order
- stateless:
    variant: rest
    action: write
    route: cancel
  steps:
  - egressAdapter:
      stateless:
        variant: rest
        service: auth
        action: read
        route: authenticate
  - egressAdapter:
      stateful:
        name: order-db
        variant: mongo
        action: read
        size: medium
  - egressAdapter:
      stateless:
        variant: rest
        service: tracking
        action: read
        route: get
  - egressAdapter:
      stateless:
        variant: rest
        service: scheduling
        action: read
        route: get
  - egressAdapter:
      stateless:
        variant: rest
        service: payment
        action: write
        route: refund
  - egressAdapter:
      stateless:
        variant: rest
        service: notification
        action: write
        route: ordercancel

# order reschedule delivery
- stateless:
    variant: rest
    action: write
    route: reschedule
  steps:
  - egressAdapter:
      stateless:
        variant: rest
        service: auth
        action: read
        route: authenticate
  - egressAdapter:
      stateful:
        name: order-db
        variant: mongo
        action: write
        size: small
  - egressAdapter:
      stateless:
        variant: rest
        service: tracking
        action: read
        route: get
  - egressAdapter:
      stateless:
        variant: rest
        service: scheduling
        action: read
        route: get
  - egressAdapter:
      stateless:
        variant: rest
        service: notification
        action: write
        route: orderrescheduled
